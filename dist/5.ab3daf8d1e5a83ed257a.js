webpackJsonp([5],{"./js/screens/store/actions.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attemptSearchQuery=t.fetchStore=t.setSearchResultsLoadingState=t.fetchStores=t.setFetchedStoreFeedState=t.toggleSearchFocus=t.setStoreTitle=t.setActiveStore=t.setSearch=void 0;var n=r("./js/screens/store/constants.js"),s=r("./js/containers/app/actions.js"),o=r("../service/service.js"),a=r("./js/services/ApiService/index.js"),i="https://instachaw.com"===window.location.origin?"https://api.instachaw.com":"http://localhost:3333",c=(t.setSearch=function(e){return{type:n.SET_SEARCH,data:e}},t.setActiveStore=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.STORES_ENDPOINT;return function(t){var r=parseInt(e.id,10),s=e.stores.filter(function(e){return e.id===r})[0];s?(t({type:n.SET_ACTIVE_STORE,data:{store:s}}),t(c(s.name))):t(l({id:r}))}},t.setStoreTitle=function(e){return e="Meals from "+e+" available on Instachaw",function(t){t((0,s.setMeta)({title:e}))}}),u=(t.toggleSearchFocus=function(e){return{type:n.SET_SEARCH_FOCUS,data:e}},function(e){return{type:n.SET_STORE,data:e}}),d=function(e){return{type:n.SET_SEARCH_RESULTS,data:e}},l=(t.setFetchedStoreFeedState=function(e){return{type:n.SET_FETCHED_STORE_FEED_STATE,data:e}},t.fetchStores=function(e){n.STORES_ENDPOINT;return h({isLoadingStores:!0}),function(t){var r=e.id?"/"+e.id:"?page="+e.page,s="api/v1/stores"+r;(0,a.sendRequest)({endpoint:i+"/"+s,method:"GET"}).then(function(r){void 0!==r&&null!==typeof r&&(e.id?(t(p(r)),t({type:n.SET_ACTIVE_STORE,data:{store:r}}),t(c(r.name))):(t(T(void 0!==e.activeStore?r.stores.filter(function(t){return t.id!==e.activeStore.id}):r.stores)),t(g({storesCount:r.storesCount})),t(S({currentStorePage:e.page+1}))),t(h({isLoadingStores:!1})))}).catch(function(e){return console.log(e)})}}),S=function(e){return{type:n.SET_CURRENT_STORES_PAGE,data:e}},h=function(e){return{type:n.SET_STORES_LOADING_STATUS,data:e}},f=t.setSearchResultsLoadingState=function(e){return{type:n.SET_SEARCH_RESULTS_LOADING_STATE,data:e}},p=(t.fetchStore=function(e){return function(t){return t((0,s.isLoading)(!0)),(0,o.getPageData)(e).then(function(e){return t((0,s.setMeta)(e.meta)),t((0,s.setUrl)(e.url)),t((0,s.setTitle)(e.title)),e}).then(function(e){t((0,s.isLoading)(!1)),t(u(e))}).catch(function(e){throw console.error(e),e})}},function(e){return{type:n.SET_STORE,data:e}}),T=function(e){return{type:n.SET_STORES,data:e}},g=function(e){return{type:n.SET_STORES_COUNT,data:e}};t.attemptSearchQuery=function(e){var t="api/v1/items?search="+e.search;return function(e){(0,a.sendRequest)({endpoint:i+"/"+t,method:"GET"}).then(function(t){void 0!==t&&null!==typeof t&&(e(d({results:t})),e(f({isLoadingSearchResults:!1})))}).catch(function(e){return console.log(e)})}}},"./js/screens/store/index.jsx":function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r("../node_modules/react/index.js"),u=n(c),d=r("../node_modules/react-redux/es/index.js"),l=r("./js/redux/reducerInjector.js"),S=n(l),h=r("./js/screens/treat/actions.js"),f=r("./js/screens/store/constants.js"),p=r("./js/screens/store/actions.js"),T=r("./js/screens/store/reducer.js"),g=r("./js/containers/app/reducer.js"),E=r("./js/screens/treat/reducer.js"),_=r("./js/screens/cart/reducer.js"),v=r("./js/util/util.js"),m=r("../node_modules/pcln-design-system/dist/index.js"),y=r("../node_modules/react-lazyload/lib/index.js"),j=(n(y),r("../node_modules/react-spinners/index.js"),r("./js/components/UI/molecules/index.js")),R=r("./js/containers/feed/index.js"),A=n(R),L=r("../node_modules/styled-components/dist/styled-components.browser.es.js"),b=(n(L),function(e){function t(e){s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleSearchStateChange=r.handleSearchStateChange.bind(r),r.runSearchQuery=(0,v.debounce)(r.runSearchQuery.bind(r),2e3),r.onSearchBarChange=r.onSearchBarChange.bind(r),r.state={search:""},r}return a(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.onLoadStore,r=e.fetchTreats,n=e.setActiveStore,s=(e.setStoreTitle,e.setFetchedStoreFeedState),o=e.store,a=e.treat,i=e.match,c=e.app,u=i.params.id,d=a.currentTreatPage,l=a.activeTreat,S=o.stores;this.props.store.activeStore.id!==u&&n({id:u,stores:S}),c.url===i.url&&t(i.path),o.hasFetchedStoreFeed[u]||(r({page:void 0===d[u]?1:d[u],store_id:u,activeTreat:l}),s({store_id:u,hasFetchedStoreFeed:!0}))}},{key:"render",value:function(){var e=this,t=this.props.store,r=(t.title,t.html,t.buttons,t.search,t.activeStore),n=(t.searchResults,t.isSearchFocused),s=(t.isLoadingSearchResults,this.props.treat),o=s.treats,a=s.treatsCount,i=s.currentTreatPage,c=s.isLoadingTreats;return!this.props.app.isLoading&&u.default.createElement(m.Flex,{style:{minHeight:"100vh",marginBottom:this.props.cart.items.length>0?"140px":"70px"},my:4,className:"transition-item",flexDirection:"column",bg:"lightGray"},u.default.createElement(m.Flex,{justify:"center",alignItems:"center"},u.default.createElement(m.Box,{px:3,width:[1,.9,.7,.7]},u.default.createElement(m.Text,{bold:!0,color:"darkGray",fontSize:4,my:3},"Make your choices."),u.default.createElement(m.Box,null,u.default.createElement(m.Box,{mb:4},u.default.createElement(A.default,{items:void 0!==o&&o.length>0?this.getActiveStoreItems(o,Number(r.id)):[],itemsCount:a,isLoading:c,onFetchNextItems:function(){n||(e.props.setTreatsLoadingStatus({isLoadingTreats:!0}),e.props.fetchTreats({page:void 0===i[r.id]?1:i[r.id],store_id:r.id}))}}))))),u.default.createElement(j.CheckoutBanner,{isVisible:this.props.cart.items.length>0&&!n,onClick:function(t){return e.props.history.push("/cart")}}))}},{key:"getActiveStoreItems",value:function(e,t){var r=e.filter(function(e){return Number(e.store_id)===t})[0];return void 0!==r?r.items:[]}},{key:"handleSearchStateChange",value:function(){this.props.onToggleSearchFocus({isSearchFocused:!0})}},{key:"onSearchBarChange",value:function(e){this.props.store.isLoadingSearchResults||this.props.setSearchResultsLoadingState({isLoadingSearchResults:!0}),this.props.setSearch({search:e}),this.runSearchQuery(e)}},{key:"runSearchQuery",value:function(e){var t=e.trim();t.length>1?this.props.attemptSearchQuery({search:t}):this.props.setSearchResultsLoadingState({isLoadingSearchResults:!1})}}],[{key:"fetchData",value:function(e,t){var r=t.path;return e.dispatch((0,p.fetchStore)(r))}},{key:"getReducer",value:function(){return{key:f.REDUCER_NAME,reducer:T.storeReducer}}}]),t}(u.default.PureComponent)),C=function(e){return{store:(0,T.getStoreState)(e).toJS(),app:(0,g.getAppState)(e).toJS(),cart:(0,_.getCartState)(e).toJS(),treat:(0,E.getTreatState)(e).toJS()}},O=function(e){return{onLoadStore:function(t){return e((0,p.fetchStore)(t))},onToggleSearchFocus:function(t){return e((0,p.toggleSearchFocus)(t))},fetchTreats:function(t){return e((0,h.fetchTreats)(t))},setTreatsLoadingStatus:function(t){return e((0,h.setTreatsLoadingStatus)(t))},attemptSearchQuery:function(t){return e((0,p.attemptSearchQuery)(t))},setSearch:function(t){return e((0,p.setSearch)(t))},setActiveStore:function(t){return e((0,p.setActiveStore)(t))},setStoreTitle:function(t){return e((0,p.setStoreTitle)(t))},setFetchedStoreFeedState:function(t){return e((0,p.setFetchedStoreFeedState)(t))},setSearchResultsLoadingState:function(t){return e((0,p.setSearchResultsLoadingState)(t))}}},F=(0,S.default)(f.REDUCER_NAME,T.storeReducer)(b);t.default=(0,d.connect)(C,O)(F)},"./js/screens/treat/actions.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setActiveTreat=t.onLoadTreat=t.setTreatsLoadingStatus=t.setTreats=t.setTreatTitle=t.fetchTreats=void 0;var n=r("./js/screens/treat/constants.js"),s=r("./js/containers/app/actions.js"),o=r("../service/service.js"),a=r("./js/services/ApiService/index.js"),i="https://instachaw.com"===window.location.origin?"https://api.instachaw.com":"http://localhost:3333",c=function(e){n.TREATS_ENDPOINT;return function(t){t(S({isLoadingTreats:!0}));var r=e.id?"/"+e.id:"?page="+e.page+"&store_id="+e.store_id,s="api/v1/items"+r;(0,a.sendRequest)({endpoint:i+"/"+s,method:"GET"}).then(function(r){void 0!==r&&null!==r&&(e.id?(t(h(r)),t(p(r.title)),t({type:n.SET_ACTIVE_TREAT,data:{treat:r}}),t(S({isLoadingTreats:!1}))):(t(f(void 0!==e.activeTreat?r.items.filter(function(t){return t.id!==e.activeTreat.id}):r.items,e.store_id)),t(l({treatsCount:r.itemsCount})),t(d({store_id:e.store_id,currentTreatPage:e.page+1}))),t(S({isLoadingTreats:!1})))}).catch(function(e){return console.log(e)})}},u=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.TREATS_ENDPOINT;return function(t){var r=parseInt(e.id,10),s=e.treats.filter(function(e){return e.id===r})[0];t(p("Treat")),s?(t(p(s.title)),t({type:n.SET_ACTIVE_TREAT,data:{treat:s}})):t(c({id:r}))}},d=function(e){return{type:n.SET_CURRENT_TREATS_PAGE,data:e}},l=function(e){return{type:n.SET_TREATS_COUNT,data:e}},S=function(e){return{type:n.SET_TREATS_LOADING_STATUS,data:e}},h=function(e){return{type:n.SET_TREAT,data:e}},f=function(e,t){return{type:n.SET_TREATS,data:e,store_id:t}},p=function(e){return function(t){t((0,s.setMeta)({title:e})),t((0,s.setTitle)(e))}},T=function(e){return{type:n.SET_TREAT_PAGE,data:e}},g=function(e){return function(t){return t((0,s.isLoading)(!0)),(0,o.getPageData)(e).then(function(e){return t((0,s.setMeta)(e.meta)),t((0,s.setUrl)(e.url)),t((0,s.setTitle)(e.title)),e}).then(function(e){t((0,s.isLoading)(!1)),t(T(e))}).catch(function(e){throw console.error(e),e})}};t.fetchTreats=c,t.setTreatTitle=p,t.setTreats=f,t.setTreatsLoadingStatus=S,t.onLoadTreat=g,t.setActiveTreat=u}});